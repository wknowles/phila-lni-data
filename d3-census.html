<!DOCTYPE html>
<meta charset="utf-8">

<style>

path {
    fill: #aaa;
    stroke: #fff;
    stroke-width: .75px;
    pointer-events: all;
}

.fill {
      fill: #fff;
      stroke: white;
  }

.text {
  font-family: sans-serif;
  font-size: 24px;
  color: #aaa;
}

.axis text {
    font: 10px sans-serif;
}

.axis line, .axis path {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
}

#key    {
    position: absolute;
    top:150px;
    left: 50px;
}
</style>
<body>

<script src="http://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>

<script>

var width = 800,
    height = 500;

var projection = d3.geoMercator()
    .center([-75.12, 40])
    .scale(80000);

var path = d3.geoPath()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var text1 = svg.append("text")
    .attr("y", height/8)
    .attr("dy", "0em")
    .attr("class", "text")
    .attr("text-anchor", "left");

var text2 = svg.append("text")
    .attr("y", height/8)
    .attr("dy", "2em")
    .attr("class", "text")
    .attr("text-anchor", "left");


</script>

<script>
//import active rentals anc census tracts
d3.csv("data/active_rental.csv", function(error, data) {
  if (error) throw error;

 // nest and rollup data
  var censusCount = d3.nest()
    .key(function(d) { return d.census_tract })
    .rollup(function(d) { return d.length; })
    .entries(data);

console.log(JSON.stringify(censusCount));

d3.json("data/census_tracts.json", function(error, topology) {
    svg.selectAll("path")
        .data(topojson.feature(topology, topology.objects.Census_Tracts_2010).features)
      .enter().append("path")
        .attr("class", "tracts")
  .attr("id", function(d){return d.properties.NAME10;})
  .attr("d", path)
  .style("fill", function(d) {return color(d.properties.NAME10); })
  .on("mouseover", function(){d3.select(this);
      text1.text("tract: " + this.id)
      text2.text("total: " + this.value)
    ;})
  });

var minimum = d3.min(censusCount, function(d) { return d.value; }), maximum = d3.max(censusCount, function(d) { return d.value; });
var minimumColor = "#edf8e9", maximumColor = "#238b45";
var color = d3.scaleLinear().domain([minimum, maximum]).range([minimumColor, maximumColor]);

var w = 140, h = 300;
var key = d3.select("body").append("svg").attr("id", "key").attr("width", w).attr("height", h);
var legend = key.append("defs").append("svg:linearGradient").attr("id", "gradient").attr("x1", "100%").attr("y1", "0%").attr("x2", "100%").attr("y2", "100%").attr("spreadMethod", "pad");
    legend.append("stop").attr("offset", "0%").attr("stop-color", maximumColor).attr("stop-opacity", 1);
    legend.append("stop").attr("offset", "100%").attr("stop-color", minimumColor).attr("stop-opacity", 1);

key.append("rect").attr("width", w - 100).attr("height", h - 100).style("fill", "url(#gradient)").attr("transform", "translate(0,10)");

var y = d3.scaleLinear().range([200, 0]).domain([minimum, maximum]);
var yAxis = d3.axisRight().scale(y);
key.append("g").attr("class", "y axis").attr("transform", "translate(42,10)").call(yAxis).append("text").attr("transform", "rotate(-90)").attr("y", 30).attr("dy", ".71em").style("text-anchor", "end").text("% Below FPL");

});

</script>
